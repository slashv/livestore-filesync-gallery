appId: com.livestore.todo
---
# Clear keychain (where expo-secure-store keeps auth tokens)
- clearKeychain

# Clear app state and stop the app
- launchApp:
    clearState: true
    stopApp: true

# Register a unique user for this test run to ensure clean state
- runScript: ../scripts/register-user.js

# Launch app fresh after registration
- launchApp

# Step 1: Login with the unique test user
- assertVisible: "Sign In"
- tapOn:
    id: "email-input"
- inputText: ${output.testUser.email}
- tapOn:
    id: "password-input"
- inputText: ${output.testUser.password}
- tapOn:
    id: "login-button"

# Dismiss iOS "Save Password" dialog if it appears
- runFlow:
    when:
      visible:
        text: ".*assword.*"
    commands:
      - tapOn:
          text: ".*ot Now.*"

# Wait for todo screen to load
- extendedWaitUntil:
    visible:
      id: "todo-input"
    timeout: 15000

# Delete any existing todo first (the "Welcome to livestore" default)
- tapOn:
    id: "todo-delete-.*"
    index: 0

# Step 2: Create a new todo
- tapOn:
    id: "todo-input"
- inputText: "E2E Test Todo"
- pressKey: Enter

# Verify todo appears
- extendedWaitUntil:
    visible:
      text: "E2E Test Todo"
    timeout: 5000

# Step 3: Mark todo as complete
- tapOn:
    id: "todo-checkbox-.*"
    index: 0

# Step 4: Delete the todo
- tapOn:
    id: "todo-delete-.*"
    index: 0

# Verify todo is gone
- extendedWaitUntil:
    notVisible:
      text: "E2E Test Todo"
    timeout: 5000
